using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class XPBar : MonoBehaviour
{
    [SerializeField] GameObject xpbar;
    [SerializeField] GameObject thewhitebar;

    //ItemXP will get changed in the player, so player needs
    //the xpbar game componenet and each time the player hits
    //an xp item the player code will get game component and
    //its amount of xp then edit itemXP (which is why itemXP is public)
    public float itemXP;
    public bool itemPicked;
    public bool barFull;
    public float maxLimit = 1.0f;
    public float minLimit = 0.0f;
    public static float currentXP = 0;

    public Vector3 position;
    public Vector3 size;
    public Vector3 origPosition;

    public IEnumerator ChangeBar(float scalar){
      yield return new WaitForSeconds(0.5f);
      float xsize = scalar+xpbar.transform.localScale.x;
      currentXP = xsize;
      size = new Vector3(position.x, 1.0f, 1.0f);
      if(xsize >= maxLimit){
        size = new Vector3(maxLimit, 1.0f, 1.0f);
      }else{
        size = new Vector3(xsize, 1.0f, 1.0f);
      }
      xpbar.transform.localScale = size;
      xpbar.transform.position = new Vector3(position.x+scalar*2.7f, position.y, position.z);
    }

    public bool checkBar(){
      if(xpbar.transform.localScale.x == maxLimit){
        return true;
      }
      return false;
    }
    // Start is called before the first frame update
    void Start()
    {
      origPosition = new Vector3(-0.5f, 0, -1.1f);
      position = xpbar.transform.position;
      itemXP = 0;
      itemPicked = false;
      barFull = false;
      StartCoroutine(ChangeBar(currentXP));
    }

    // Update is called once per frame
    void Update()
    {
        position = xpbar.transform.position;

        if(itemPicked == true){
          StartCoroutine(ChangeBar(itemXP));
          itemXP = 0;
          itemPicked = false;
        }

        if(checkBar()){
          barFull = true;
          xpbar.transform.localScale = new Vector3(minLimit, 1.0f, 1.0f);
          xpbar.transform.position = new Vector3(thewhitebar.transform.position.x, thewhitebar.transform.position.y, thewhitebar.transform.position.z);
          currentXP = 0;
        }
    }
}
